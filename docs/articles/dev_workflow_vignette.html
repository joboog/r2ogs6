<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="r2ogs6">
<title>r2ogs6 Developer Guide • r2ogs6</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="r2ogs6 Developer Guide">
<meta property="og:description" content="r2ogs6">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">r2ogs6</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.652</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/dev_workflow_vignette.html">r2ogs6 Developer Guide</a>
    <a class="dropdown-item" href="../articles/ensemble_workflow_vignette.html">r2ogs6 Ensemble Guide</a>
    <a class="dropdown-item" href="../articles/user_workflow_vignette.html">User Guide</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="dev_workflow_vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>r2ogs6 Developer Guide</h1>
            
            <h4 data-toc-skip class="date">2023-04-05</h4>
      
      
      <div class="d-none name"><code>dev_workflow_vignette.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">r2ogs6</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="hi-there">Hi there!<a class="anchor" aria-label="anchor" href="#hi-there"></a>
</h2>
<p>Welcome to my dev guide on <code>r2ogs6</code>. This is a collection of tips, useful info (and admittedly a few warnings) which will hopefully make your life a bit easier when developing this package.</p>
</div>
<div class="section level2">
<h2 id="the-basics">The basics<a class="anchor" aria-label="anchor" href="#the-basics"></a>
</h2>
<p>Before we dive into any implementation details, we will take a look at how exactly this package is structured first. <code>r2ogs6</code> was developed using the workflow described <a href="https://r-pkgs.org/index.html" class="external-link">here</a>. I strongly recommend keeping it that way as it will save you time and headaches.</p>
<p>…</p>
<p>In the main folder <code>R/</code> you will find a lot of scripts, most of which can be grouped into the following categories:</p>
<ul>
<li><p><code>export_*.R</code> export functions</p></li>
<li><p><code>generate_*.R</code> code generation</p></li>
<li><p><code>read_in_*.R</code> import functions</p></li>
<li><p><code>ogs6_*.R</code> simulation class definitions</p></li>
<li><p><code>prj_*.R</code> class definitions for XML tags found in a <code>.prj</code> file</p></li>
<li><p><code>*_utils.R</code> utility functions used in multiple scripts</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="the-classes">The classes<a class="anchor" aria-label="anchor" href="#the-classes"></a>
</h2>
<p><code>r2ogs6</code> is largely built on top of S3 classes at the moment. For reasons I will elaborate on later, it is very viable to switch to R6 classes. But let’s look at what we have first.</p>
<p>….</p>
</div>
<div class="section level2">
<h2 id="generating-new-classes">Generating new classes<a class="anchor" aria-label="anchor" href="#generating-new-classes"></a>
</h2>
<p>If you’ve familiarized yourself with OpenGeoSys 6, you know that there are a lot, and by a lot I mean a LOT of parameters and special cases regarding the <code>.prj</code> XML tags. For a nice new class based on such a tag, you will have to consider all of them.</p>
<p>To save me (and you) a bit of typing, I’ve written a few useful functions for this.</p>
<div class="section level3">
<h3 id="analyse_xml">analyse_xml()<a class="anchor" aria-label="anchor" href="#analyse_xml"></a>
</h3>
<p>The first and arguably most important one is <code>analyse_xml()</code>. It matches files in a folder, reads them in as XML and searches for XML elements of a given name. It then analyses those elements and returns useful information about them, namely the names of their attributes and child elements. It prints a summary of its findings and also returns a list which we will look at in a moment.</p>
<p>I used this function for two things: Analysing … . Secondly, as soon as I had decided which tags should be represented by a class, I used the function output for class generation.</p>
</div>
<div class="section level3">
<h3 id="generate_">generate_*()<a class="anchor" aria-label="anchor" href="#generate_"></a>
</h3>
<p>So say we have some <code>.prj</code> files stored in a folder. I will show the workflow on a small dataset (that is, on a folder with only two <code>.prj</code> files) here, the path I usually passed to <code>analyse_xml()</code> was the directory containing all of the benchmark files for OpenGeoSys 6 which can be downloaded from <a href="https://gitlab.opengeosys.org/ogs/ogs/-/tree/master/Tests/Data/" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_folder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/vignettes_data/analyse_xml_demo"</span>, </span>
<span>                           package <span class="op">=</span> <span class="st">"r2ogs6"</span><span class="op">)</span></span></code></pre></div>
<p>Now say we have decided we are going to make a class based on the element with tag name <code>nonlinear_solver</code>. For readability reasons, I will store the results of <code>analyse_xml()</code> in a variable and pass it to our generator function. If you want, you can skip this step and call <code>analyse_xml()</code> in the generator function directly.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">analysis_results</span> <span class="op">&lt;-</span> <span class="fu">analyse_xml</span><span class="op">(</span>path <span class="op">=</span> <span class="va">test_folder</span>,</span>
<span>                                pattern <span class="op">=</span> <span class="st">"\\.prj$"</span>,</span>
<span>                                xpath <span class="op">=</span> <span class="st">"//nonlinear_solver"</span>,</span>
<span>                                print_findings <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; I parsed 2 valid XML files matching your pattern.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; I found at least one element named nonlinear_solver in the following file(s):</span></span>
<span><span class="co">#&gt; beam.prj </span></span>
<span><span class="co">#&gt; beam3d.prj </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; In total, I found 5 element(s) named nonlinear_solver.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; These are the child elements I found:</span></span>
<span><span class="co">#&gt;                 name ex_occ p_occ total total_mean</span></span>
<span><span class="co">#&gt; 1               name      2   0.4     2        0.4</span></span>
<span><span class="co">#&gt; 2               type      2   0.4     2        0.4</span></span>
<span><span class="co">#&gt; 3           max_iter      2   0.4     2        0.4</span></span>
<span><span class="co">#&gt; 4      linear_solver      2   0.4     2        0.4</span></span>
<span><span class="co">#&gt; 5 maximum_iterations      1   0.2     1        0.2</span></span>
<span><span class="co">#&gt; 6    error_tolerance      1   0.2     1        0.2</span></span>
<span><span class="co">#&gt; 7            damping      1   0.2     1        0.2</span></span></code></pre></div>
<p>First, I define my path and specify that only files with the ending <code>.prj</code> will be parsed. I’m looking for elements named <code>nonlinear_solver</code>, and I’m looking for them in the whole document. This often isn’t the best option since sometimes nodes may have the same name but contain different things depending on their exact position in the document, which is also the case here. To narrow it down further, change <code>xpath</code> accordingly.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">analysis_results</span> <span class="op">&lt;-</span> <span class="fu">analyse_xml</span><span class="op">(</span>path <span class="op">=</span> <span class="va">test_folder</span>,</span>
<span>                                pattern <span class="op">=</span> <span class="st">"\\.prj$"</span>,</span>
<span>                                xpath <span class="op">=</span> <span class="st">"/OpenGeoSysProject/nonlinear_solvers/nonlinear_solver"</span>,</span>
<span>                                print_findings <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; I parsed 2 valid XML files matching your pattern.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; I found at least one element named nonlinear_solver in the following file(s):</span></span>
<span><span class="co">#&gt; beam.prj </span></span>
<span><span class="co">#&gt; beam3d.prj </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; In total, I found 2 element(s) named nonlinear_solver.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; These are the child elements I found:</span></span>
<span><span class="co">#&gt;            name ex_occ p_occ total total_mean</span></span>
<span><span class="co">#&gt; 1          name      2   1.0     2        1.0</span></span>
<span><span class="co">#&gt; 2          type      2   1.0     2        1.0</span></span>
<span><span class="co">#&gt; 3      max_iter      2   1.0     2        1.0</span></span>
<span><span class="co">#&gt; 4 linear_solver      2   1.0     2        1.0</span></span>
<span><span class="co">#&gt; 5       damping      1   0.5     1        0.5</span></span></code></pre></div>
<p>Now we can be sure our future class will be generated from the correct parameters. <code>analyse_xml()</code> returns a named list invisibly, let’s have a short look at it.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">analysis_results</span></span>
<span><span class="co">#&gt; $xpath</span></span>
<span><span class="co">#&gt; [1] "/OpenGeoSysProject/nonlinear_solvers/nonlinear_solver"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $children</span></span>
<span><span class="co">#&gt;          name          type      max_iter linear_solver       damping </span></span>
<span><span class="co">#&gt;          TRUE          TRUE          TRUE          TRUE         FALSE </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $attributes</span></span>
<span><span class="co">#&gt; logical(0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $both_sorted</span></span>
<span><span class="co">#&gt;          name          type      max_iter linear_solver       damping </span></span>
<span><span class="co">#&gt;          TRUE          TRUE          TRUE          TRUE         FALSE</span></span></code></pre></div>
<p>You can see the list contains the <code>xpath</code> parameter passed to <code>analyse_xml()</code>, along with three named logical vectors called <code>children</code>, <code>attributes</code> and <code>both_sorted</code> respectively. They can be read like this: If an attribute or a child of the element specified by <code>xpath</code> always occurred, it is a required parameter for the new class. Else, it is an optional parameter. The logical vectors are sorted by occurrency, so the rarest children and attributes will go to the very end of their logical vector. Now, let’s generate some code!</p>
<p>For S3 classes, we generate a constructor like this:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">generate_constructor</span><span class="op">(</span>params <span class="op">=</span> <span class="va">analysis_results</span>,</span>
<span>                     print_result <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; new_prj_nonlinear_solver &lt;- function(name,</span></span>
<span><span class="co">#&gt; type,</span></span>
<span><span class="co">#&gt; max_iter,</span></span>
<span><span class="co">#&gt; linear_solver,</span></span>
<span><span class="co">#&gt; damping = NULL) {</span></span>
<span><span class="co">#&gt; structure(list(name = name,</span></span>
<span><span class="co">#&gt; type = type,</span></span>
<span><span class="co">#&gt; max_iter = max_iter,</span></span>
<span><span class="co">#&gt; linear_solver = linear_solver,</span></span>
<span><span class="co">#&gt; damping = damping,</span></span>
<span><span class="co">#&gt; xpath = "nonlinear_solvers/nonlinear_solver",</span></span>
<span><span class="co">#&gt; attr_names = c(),</span></span>
<span><span class="co">#&gt; flatten_on_exp = character()</span></span>
<span><span class="co">#&gt; ),</span></span>
<span><span class="co">#&gt; class = "prj_nonlinear_solver"</span></span>
<span><span class="co">#&gt; )</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>For S3 classes, we generate a helper like this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">generate_helper</span><span class="op">(</span>params <span class="op">=</span> <span class="va">analysis_results</span>,</span>
<span>                print_result <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; #'prj_nonlinear_solver</span></span>
<span><span class="co">#&gt; #'@description tag: nonlinear_solver</span></span>
<span><span class="co">#&gt; #'@param name</span></span>
<span><span class="co">#&gt; #'@param type</span></span>
<span><span class="co">#&gt; #'@param max_iter</span></span>
<span><span class="co">#&gt; #'@param linear_solver</span></span>
<span><span class="co">#&gt; #'@param damping Optional: </span></span>
<span><span class="co">#&gt; #'@export</span></span>
<span><span class="co">#&gt; prj_nonlinear_solver &lt;- function(name,</span></span>
<span><span class="co">#&gt; type,</span></span>
<span><span class="co">#&gt; max_iter,</span></span>
<span><span class="co">#&gt; linear_solver,</span></span>
<span><span class="co">#&gt; damping = NULL) {</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Add coercing utility here</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; new_prj_nonlinear_solver(name,</span></span>
<span><span class="co">#&gt; type,</span></span>
<span><span class="co">#&gt; max_iter,</span></span>
<span><span class="co">#&gt; linear_solver,</span></span>
<span><span class="co">#&gt; damping)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>For R6 classes, we generate a constructor like this:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">generate_R6</span><span class="op">(</span>params <span class="op">=</span> <span class="va">analysis_results</span>,</span>
<span>            print_result <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; OGS6_nonlinear_solver &lt;- R6::R6Class("OGS6_nonlinear_solver",</span></span>
<span><span class="co">#&gt; public = list(</span></span>
<span><span class="co">#&gt; #'@description</span></span>
<span><span class="co">#&gt; #'Creates new OGS6_nonlinear_solverobject</span></span>
<span><span class="co">#&gt; #'@param name</span></span>
<span><span class="co">#&gt; #'@param type</span></span>
<span><span class="co">#&gt; #'@param max_iter</span></span>
<span><span class="co">#&gt; #'@param linear_solver</span></span>
<span><span class="co">#&gt; #'@param damping Optional: initialize = function(name,</span></span>
<span><span class="co">#&gt; type,</span></span>
<span><span class="co">#&gt; max_iter,</span></span>
<span><span class="co">#&gt; linear_solver,</span></span>
<span><span class="co">#&gt; damping = NULL){</span></span>
<span><span class="co">#&gt; self$name &lt;- name</span></span>
<span><span class="co">#&gt; self$type &lt;- type</span></span>
<span><span class="co">#&gt; self$max_iter &lt;- max_iter</span></span>
<span><span class="co">#&gt; self$linear_solver &lt;- linear_solver</span></span>
<span><span class="co">#&gt; self$damping &lt;- damping</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; ),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; active = list(</span></span>
<span><span class="co">#&gt; #'@field name</span></span>
<span><span class="co">#&gt; #'Access to private parameter '.name'</span></span>
<span><span class="co">#&gt; name = function(value) {</span></span>
<span><span class="co">#&gt; if(missing(value)) {</span></span>
<span><span class="co">#&gt; private$.name</span></span>
<span><span class="co">#&gt; }else{</span></span>
<span><span class="co">#&gt; private$.name &lt;- value</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; },</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #'@field type</span></span>
<span><span class="co">#&gt; #'Access to private parameter '.type'</span></span>
<span><span class="co">#&gt; type = function(value) {</span></span>
<span><span class="co">#&gt; if(missing(value)) {</span></span>
<span><span class="co">#&gt; private$.type</span></span>
<span><span class="co">#&gt; }else{</span></span>
<span><span class="co">#&gt; private$.type &lt;- value</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; },</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #'@field max_iter</span></span>
<span><span class="co">#&gt; #'Access to private parameter '.max_iter'</span></span>
<span><span class="co">#&gt; max_iter = function(value) {</span></span>
<span><span class="co">#&gt; if(missing(value)) {</span></span>
<span><span class="co">#&gt; private$.max_iter</span></span>
<span><span class="co">#&gt; }else{</span></span>
<span><span class="co">#&gt; private$.max_iter &lt;- value</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; },</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #'@field linear_solver</span></span>
<span><span class="co">#&gt; #'Access to private parameter '.linear_solver'</span></span>
<span><span class="co">#&gt; linear_solver = function(value) {</span></span>
<span><span class="co">#&gt; if(missing(value)) {</span></span>
<span><span class="co">#&gt; private$.linear_solver</span></span>
<span><span class="co">#&gt; }else{</span></span>
<span><span class="co">#&gt; private$.linear_solver &lt;- value</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; },</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #'@field damping</span></span>
<span><span class="co">#&gt; #'Access to private parameter '.damping'</span></span>
<span><span class="co">#&gt; damping = function(value) {</span></span>
<span><span class="co">#&gt; if(missing(value)) {</span></span>
<span><span class="co">#&gt; private$.damping</span></span>
<span><span class="co">#&gt; }else{</span></span>
<span><span class="co">#&gt; private$.damping &lt;- value</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; },</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #'@field is_subclass</span></span>
<span><span class="co">#&gt; #'Access to private parameter '.is_subclass'</span></span>
<span><span class="co">#&gt; is_subclass = function() {</span></span>
<span><span class="co">#&gt; private$.is_subclass</span></span>
<span><span class="co">#&gt; },</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #'@field subclasses_names</span></span>
<span><span class="co">#&gt; #'Access to private parameter '.subclasses_names'</span></span>
<span><span class="co">#&gt; subclasses_names = function() {</span></span>
<span><span class="co">#&gt; private$.subclasses_names</span></span>
<span><span class="co">#&gt; },</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; #'@field attr_names</span></span>
<span><span class="co">#&gt; #'Access to private parameter '.attr_names'</span></span>
<span><span class="co">#&gt; attr_names = function() {</span></span>
<span><span class="co">#&gt; private$.attr_names</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; ),</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; private = list(</span></span>
<span><span class="co">#&gt; .name = NULL,</span></span>
<span><span class="co">#&gt; .type = NULL,</span></span>
<span><span class="co">#&gt; .max_iter = NULL,</span></span>
<span><span class="co">#&gt; .linear_solver = NULL,</span></span>
<span><span class="co">#&gt; .damping = NULL,</span></span>
<span><span class="co">#&gt; .is_subclass = TRUE,</span></span>
<span><span class="co">#&gt; .subclasses_names = character(),</span></span>
<span><span class="co">#&gt; .attr_names = c(),</span></span>
<span><span class="co">#&gt; )</span></span>
<span><span class="co">#&gt; )</span></span></code></pre></div>
<p>Ta-daa, you now have some nice stubs. Copy them into a script in the <code>R</code> folder of this package, add some documentation and validation to it and you’re almost done.</p>
</div>
</div>
<div class="section level2">
<h2 id="integrating-new-classes">Integrating new classes<a class="anchor" aria-label="anchor" href="#integrating-new-classes"></a>
</h2>
<p>Now that we have a class, we need to tell the package it exists. This is so when we’re reading in or exporting a <code>.prj</code> file, it knows to automatically turn the content of our <code>nonlinear_solver</code> tag into an object of our new class and the other way around. To achieve this, execute the code in <code>data_raw/xpaths_for_classes.R</code>. What this will do is update the <code>xpaths_for_classes</code> parameter, adding an entry for your class. Afterwards, run <code>xpaths_for_classes[["your_class_name"]]</code>. It should return the <code>xpath</code> parameter of your class like so:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xpaths_for_classes</span><span class="op">[[</span><span class="st">"prj_process"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># A class can have multiple xpaths if the represented node occurs at different positions.</span></span>
<span><span class="va">xpaths_for_classes</span><span class="op">[[</span><span class="st">"prj_convergence_criterion"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>If the class you’ve created is a <code>.prj</code> top level class or a child of a top level wrapper node like <code>processes</code>, add a corresponding <code>OGS6</code> private parameter and an active field. For example, the <code>processes</code> node is represented as a list, so I added the private parameter <code>.processes = list()</code> and the active field <code>processes</code>.</p>
<p>A lot of things in the <code>r2ogs6</code> package work in a way that is a bit “meta”. Often times, functions are called via <code>eval(parse(text = call_string))</code> where <code>call_string</code> has for example been concatenated out of info about the parameter names of a certain class. This saves a lot of code regarding import, export and script generation but requires that you’ve made the respective info available as shown here.</p>
<p>So we’ve analysed some files, generated some code, created a new class and registered it with the package… what now? That’s it actually, that’s the workflow. Well, at least it’s supposed to be.</p>
</div>
<div class="section level2">
<h2 id="recursive-function-guide">Recursive function guide<a class="anchor" aria-label="anchor" href="#recursive-function-guide"></a>
</h2>
<p>If that wasn’t it, I’m afraid you might have to take a look at the functions handling import, export and benchmark script generation. These are a bit tricky because they use recursion which so far has proven to be efficient structure-wise but not exactly fun to think about.</p>
<div class="section level3">
<h3 id="read_in">read_in<a class="anchor" aria-label="anchor" href="#read_in"></a>
</h3>
</div>
<div class="section level3">
<h3 id="to_node">to_node<a class="anchor" aria-label="anchor" href="#to_node"></a>
</h3>
</div>
<div class="section level3">
<h3 id="generate_benchmark_script">generate_benchmark_script<a class="anchor" aria-label="anchor" href="#generate_benchmark_script"></a>
</h3>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>I hope you’ve taken away some helpful information from this short guide. If you make changes to improve the workflow, please update this vignette for the next dev!</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ruben Heinrich, Johannes Boog, Philipp Schad, Helmholtz Centre for Environmental Research - UFZ.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
