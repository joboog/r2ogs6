<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="r2ogs6">
<title>User Guide • r2ogs6</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="User Guide">
<meta property="og:description" content="r2ogs6">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">r2ogs6</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.644</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/dev_workflow_vignette.html">r2ogs6 Developer Guide</a>
    <a class="dropdown-item" href="../articles/ensemble_workflow_vignette.html">r2ogs6 Ensemble Guide</a>
    <a class="dropdown-item" href="../articles/user_workflow_vignette.html">User Guide</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="user_workflow_vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>User Guide</h1>
            
            <h4 data-toc-skip class="date">2023-04-05</h4>
      
      
      <div class="d-none name"><code>user_workflow_vignette.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">r2ogs6</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>This guide assumes you have <code>r2ogs6</code> and its dependencies installed. If that’s not the case, please take a look at the installation instructions provided in the <code>README.md</code> file of the repository.</p>
<p>After loading <code>r2ogs6</code>, we first need to set the package options so it knows where to look for OpenGeoSys 6.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set path for OpenGeoSys 6</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"r2ogs6.default_ogs6_bin_path"</span> <span class="op">=</span> <span class="st">"your_ogs6_bin_path"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-your-simulation-object">Creating your simulation object<a class="anchor" aria-label="anchor" href="#creating-your-simulation-object"></a>
</h2>
<p>To represent a simulation object, <code>r2ogs6</code> uses an <code>R6</code> class called <code>OGS6</code>. If you’re new to <code>R6</code> objects, don’t worry. Creating a simulation object is easy. We call the class constructor and provide it with some parameters:</p>
<ul>
<li><p><code>sim_name</code> The name of your simulation</p></li>
<li><p><code>sim_path</code> All relevant files for your simulation will be in here</p></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Change this to fit your system</span></span>
<span><span class="co"># sim_path &lt;- system.file("extdata/benchmarks/flow_no_strain",</span></span>
<span><span class="co">#                         package = "r2ogs6")</span></span>
<span><span class="va">sim_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ogs6_obj</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/OGS6.html">OGS6</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>sim_name <span class="op">=</span> <span class="st">"my_simulation"</span>,</span>
<span>                     sim_path <span class="op">=</span> <span class="va">sim_path</span><span class="op">)</span></span></code></pre></div>
<p>And that’s it, we now have a simulation object.</p>
</div>
<div class="section level2">
<h2 id="defining-the-simulation-parameters">Defining the simulation parameters<a class="anchor" aria-label="anchor" href="#defining-the-simulation-parameters"></a>
</h2>
<p>From here on there’s two ways you can define the simulation parameters. Either you load a benchmark file or you define your simulation manually.</p>
<div class="section level3">
<h3 id="loading-a-benchmark-file">Loading a benchmark file<a class="anchor" aria-label="anchor" href="#loading-a-benchmark-file"></a>
</h3>
<p>The quickest and easiest way to define a simulation is by using an already existing benchmark. If you take a look at the <a href="https://www.opengeosys.org/docs/benchmarks/elliptic/elliptic-dirichlet/" class="external-link">OpenGeoSys documentation</a>, you’ll find plenty of benchmarks to choose from along with a link to their project file on GitLab at the top of the respective page.</p>
<p>For demonstration purposes, I will use a project from the <code>HydroMechanics</code> benchmarks, which can be found <a href="https://gitlab.opengeosys.org/ogs/ogs/-/tree/master/Tests/Data/HydroMechanics/IdealGas/flow_no_strain" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Change this to fit your system</span></span>
<span><span class="co">#prj_path &lt;- paste0(sim_path, "/flow_no_strain.prj")</span></span>
<span><span class="va">prj_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/benchmarks/flow_no_strain/flow_no_strain.prj"</span>,</span>
<span>                       package <span class="op">=</span> <span class="st">"r2ogs6"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/read_in_prj.html">read_in_prj</a></span><span class="op">(</span><span class="va">ogs6_obj</span>, prj_path <span class="op">=</span> <span class="va">prj_path</span>, read_in_gml <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p>NOTE: <code>r2ogs6</code> has not been tested with every existing benchmark. Due to the large number of input parameters, you might encounter cases where the import fails.</p>
</div>
<div class="section level3">
<h3 id="setting-up-your-own-opengeosys-6-simulation">Setting up your own OpenGeoSys 6 simulation<a class="anchor" aria-label="anchor" href="#setting-up-your-own-opengeosys-6-simulation"></a>
</h3>
<p>Setting up your own simulation is possible too.</p>
<p>Since there’s plenty of required and optional input parameters, you might want to call <code>get_status()</code> occasionally to get a brief overview of your simulation. This tells you which input parameters are missing before you can run a simulation.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Call on the OGS6 object (note the R6 style)</span></span>
<span><span class="va">ogs6_obj</span><span class="op">$</span><span class="fu">get_status</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✓ 'processes' has at least one element</span></span>
<span><span class="co">#&gt; ✓ 'time_loop' is defined</span></span>
<span><span class="co">#&gt; ✓ 'nonlinear_solvers' has at least one element</span></span>
<span><span class="co">#&gt; ✓ 'linear_solvers' has at least one element</span></span>
<span><span class="co">#&gt; ✓ 'parameters' has at least one element</span></span>
<span><span class="co">#&gt; ✓ 'process_variables' has at least one element</span></span>
<span><span class="co">#&gt; ✗ 'mesh' is defined</span></span>
<span><span class="co">#&gt; ✗ 'geometry' is defined</span></span>
<span><span class="co">#&gt; ✓ 'media' has at least one element</span></span>
<span><span class="co">#&gt; ✗ 'test_definition' has at least one element</span></span>
<span><span class="co">#&gt; ✗ 'curves' has at least one element</span></span>
<span><span class="co">#&gt; ✓ 'meshes' has at least one element</span></span>
<span><span class="co">#&gt; ✗ 'local_coordinate_system' is defined</span></span>
<span><span class="co">#&gt; ✗ 'search_length_algorithm' is defined</span></span>
<span><span class="co">#&gt; ✗ 'chemical_system' is defined</span></span>
<span><span class="co">#&gt; ✗ 'python_script' is defined</span></span>
<span><span class="co">#&gt; ✗ 'insitu' is definedYour OGS6 object has all necessary components.</span></span>
<span><span class="co">#&gt; You can try calling ogs6_run_simulation().Note that this calls more validation functions, so you may not be done just yet.</span></span></code></pre></div>
<p>Since we haven’t defined anything so far, you’ll see a lot of red there. But the results gave us a hint what we can add. We’ll go from there and try to find out more about the possible input data. Say we want to find out more about <code>process</code> objects.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># To take a look at the documentation, use ? followed by the name of a class</span></span>
<span><span class="op">?</span><span class="va">prj_process</span></span></code></pre></div>
<p>As a rule of thumb, classes are named with the prefix <code>prj_</code> followed by their XML tag name in the <code>.prj</code> file. The only exceptions to this rule are subclasses where this would lead to duplicate class names. The class <code>prj_time_loop</code> for example contains a subclass representing a <code>process</code> child element which is not to be confused with the <code>process</code> children of the first level <code>processes</code> node directly under the root node of the <code>.prj</code> file. Because of this, that subclass is named <code>prj_tl_process</code>. Let’s try adding something now.</p>
<p>To add data to our simulation object, we use <code>OGS6$add()</code>. We can use this method with any top level <code>.prj</code> element, which means we’re not limited to <code>prj_parameter</code> objects.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add a parameter</span></span>
<span><span class="va">ogs6_obj</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="fu"><a href="../reference/prj_parameter.html">prj_parameter</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"E"</span>,</span>
<span>                           type <span class="op">=</span> <span class="st">"Constant"</span>,</span>
<span>                           value <span class="op">=</span> <span class="fl">1e+10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Add a process variable</span></span>
<span><span class="va">ogs6_obj</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/prj_process_variable.html">prj_process_variable</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="st">"pressure"</span>,</span>
<span>        components <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        order <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        initial_condition <span class="op">=</span> <span class="st">"pressure0"</span>,</span>
<span>        boundary_conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            boundary_condition <span class="op">=</span> <span class="fu"><a href="../reference/prj_boundary_condition.html">prj_boundary_condition</a></span><span class="op">(</span></span>
<span>                type <span class="op">=</span> <span class="st">"Neumann"</span>,</span>
<span>                parameter <span class="op">=</span> <span class="st">"flux_in"</span>,</span>
<span>                geometrical_set <span class="op">=</span> <span class="st">"cube_1x1x1_geometry"</span>,</span>
<span>                geometry <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>                component <span class="op">=</span> <span class="fl">0</span></span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Since I already read in a <code>.prj</code> file earlier, I won’t run the above snippet. If you’d like a complete example of manually defining simulation parameters, there’s a script <code>flow_free_expansion.R</code> in the <code>examples/workflow_demos</code> folder.</p>
</div>
</div>
<div class="section level2">
<h2 id="running-the-simulation">Running the simulation<a class="anchor" aria-label="anchor" href="#running-the-simulation"></a>
</h2>
<p>As soon as we’ve added all necessary parameters, we can try starting our simulation. This will run a few additional checks and then start OpenGeoSys 6. If <code>write_logfile</code> is set to <code>FALSE</code>, the output from OpenGeoSys 6 will be shown on the console.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/ogs6_run_simulation.html">ogs6_run_simulation</a></span><span class="op">(</span><span class="va">ogs6_obj</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="retrieve-the-results">Retrieve the results<a class="anchor" aria-label="anchor" href="#retrieve-the-results"></a>
</h2>
<p>After our simulation is finished, we might want to plot some results. But how do we retrieve them? If all went as expected, we don’t need to call an extra function for that because <code><a href="../reference/ogs6_run_simulation.html">ogs6_run_simulation()</a></code> already calls <code><a href="../reference/ogs6_read_output_files.html">ogs6_read_output_files()</a></code> internally. We only need to decide what information we want to extract. Say we’re interested in the <code>pressure</code> Parameter from the last timestep. For this easy example, only one <code>.pvd</code> file was produced.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ogs6_read_output_files.html">ogs6_read_output_files</a></span><span class="op">(</span><span class="va">ogs6_obj</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract relevant info into dataframe</span></span>
<span><span class="va">result_df</span> <span class="op">&lt;-</span> <span class="va">ogs6_obj</span><span class="op">$</span><span class="va">pvds</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">get_point_data</span><span class="op">(</span>keys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pressure"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">result_df</span> <span class="op">&lt;-</span> <span class="va">result_df</span><span class="op">[</span><span class="op">(</span><span class="va">result_df</span><span class="op">$</span><span class="va">timestep</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot results</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">result_df</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>,</span>
<span>           y <span class="op">=</span> <span class="va">y</span>,</span>
<span>           color <span class="op">=</span> <span class="va">pressure</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co">#geom_raster(interpolate = T)+</span></span>
<span>    <span class="co">#geom_contour_filled()+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"x coordinate"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"y coordinate"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="r2ogs6-user-guide-plot-1.png" alt=""><p class="caption">plot of chunk user-guide-plot</p>
</div>
<p>Similar to the idea with <code>.pvd</code> output, <code>hdf5</code> files are automatically referenced under <code>$h5s</code> if returned by the simulation. Here, we have added a file artificially from the benchmark library for demonstration.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ogs6_obj</span><span class="op">$</span><span class="va">h5s</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; OGS6_h5</span></span>
<span><span class="co">#&gt; h5 path:</span></span>
<span><span class="co">#&gt; /work/ufz/r2ogs6/inst/extdata/benchmarks/EllipticPETSc/cube_1e3_np3.h5 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # h5 file structure ------------------------------------------------------ </span></span>
<span><span class="co">#&gt;    group                   name       otype  dclass      dim</span></span>
<span><span class="co">#&gt; 0      /                    t_0   H5I_GROUP                 </span></span>
<span><span class="co">#&gt; 1   /t_0 D1_left_front_N1_right H5I_DATASET   FLOAT     1895</span></span>
<span><span class="co">#&gt; 2   /t_0     Linear_1_to_minus1 H5I_DATASET   FLOAT     1895</span></span>
<span><span class="co">#&gt; 3   /t_0            MaterialIDs H5I_DATASET INTEGER     1233</span></span>
<span><span class="co">#&gt; 4   /t_0               geometry H5I_DATASET   FLOAT 3 x 1895</span></span>
<span><span class="co">#&gt; 5   /t_0               pressure H5I_DATASET   FLOAT     1895</span></span>
<span><span class="co">#&gt; 6   /t_0               topology H5I_DATASET INTEGER    11097</span></span>
<span><span class="co">#&gt; 7   /t_0                      v H5I_DATASET   FLOAT 3 x 1895</span></span>
<span><span class="co">#&gt; 8      /                    t_1   H5I_GROUP                 </span></span>
<span><span class="co">#&gt; 9   /t_1               pressure H5I_DATASET   FLOAT     1895</span></span>
<span><span class="co">#&gt; 10  /t_1                      v H5I_DATASET   FLOAT 3 x 1895</span></span></code></pre></div>
<p>As can be seen, hdf5 files have a very particular structure. To work with the data, a simple method <code>get_h5()</code> allows to access the different data elements as a very raw starting point for post processing the data.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">h5_list</span> <span class="op">&lt;-</span> <span class="va">ogs6_obj</span><span class="op">$</span><span class="va">h5s</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">get_h5</span><span class="op">(</span><span class="st">"/"</span><span class="op">)</span></span></code></pre></div>
<p>Other functions such as HDF5 handles for dataset processing can be used directly from the <em>rhdf5</em> package, of course. The path to the hd5 file is available as an active field <code>h5_path</code> that can be accessed or changed in the <em>OGS6</em> object.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_h5</span> <span class="op">&lt;-</span> <span class="fu">rhdf5</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rhdf5/man/H5Fopen.html" class="external-link">H5Fopen</a></span><span class="op">(</span><span class="va">ogs6_obj</span><span class="op">$</span><span class="va">h5s</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">h5_path</span><span class="op">)</span></span>
<span><span class="va">example_h5</span></span>
<span><span class="co">#&gt; HDF5 FILE </span></span>
<span><span class="co">#&gt;         name /</span></span>
<span><span class="co">#&gt;     filename </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   name     otype dclass dim</span></span>
<span><span class="co">#&gt; 0  t_0 H5I_GROUP           </span></span>
<span><span class="co">#&gt; 1  t_1 H5I_GROUP</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">example_h5</span><span class="op">$</span><span class="va">t_0</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 7</span></span>
<span><span class="co">#&gt;  $ D1_left_front_N1_right: num [1:1895(1d)] 1 1 1 1 1.01 ...</span></span>
<span><span class="co">#&gt;  $ Linear_1_to_minus1    : num [1:1895(1d)] 1 0.8 0.6 1 0.8 0.6 1 0.8 0.6 1 ...</span></span>
<span><span class="co">#&gt;  $ MaterialIDs           : int [1:1233(1d)] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ geometry              : num [1:3, 1:1895] 0 0 0 0.1 0 0 0.2 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ pressure              : num [1:1895(1d)] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ topology              : int [1:11097(1d)] 9 0 1 4 3 49 50 53 52 9 ...</span></span>
<span><span class="co">#&gt;  $ v                     : num [1:3, 1:1895] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="fu">rhdf5</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rhdf5/man/h5closeAll.html" class="external-link">h5closeAll</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>If the file has a reasonably “clean” structure, a more convenient way of importing the data is using the method <code>get_df</code> that returns a <em>tibble</em> table.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">ogs6_obj</span><span class="op">$</span><span class="va">h5s</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">get_df</span><span class="op">(</span>group <span class="op">=</span> <span class="st">"/t_0"</span>, names <span class="op">=</span> <span class="st">"pressure"</span><span class="op">)</span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt; # A tibble: 1,895 × 5</span></span>
<span><span class="co">#&gt;        x     y     z  time pressure</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1   0     0       0     0        0</span></span>
<span><span class="co">#&gt;  2   0.1   0       0     0        0</span></span>
<span><span class="co">#&gt;  3   0.2   0       0     0        0</span></span>
<span><span class="co">#&gt;  4   0     0.1     0     0        0</span></span>
<span><span class="co">#&gt;  5   0.1   0.1     0     0        0</span></span>
<span><span class="co">#&gt;  6   0.2   0.1     0     0        0</span></span>
<span><span class="co">#&gt;  7   0     0.2     0     0        0</span></span>
<span><span class="co">#&gt;  8   0.1   0.2     0     0        0</span></span>
<span><span class="co">#&gt;  9   0.2   0.2     0     0        0</span></span>
<span><span class="co">#&gt; 10   0     0.3     0     0        0</span></span>
<span><span class="co">#&gt; # … with 1,885 more rows</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-multiple-simulations">Running multiple simulations<a class="anchor" aria-label="anchor" href="#running-multiple-simulations"></a>
</h2>
<p>If we want to run not one but multiple simulations, we can use the simulation object we just created as a blueprint for an ensemble run. The workflow for this is described in detail <a href="ensemble_workflow_vignette.Rmd">here</a>.</p>
</div>
<div class="section level2">
<h2 id="benchmark-script-generation">Benchmark script generation<a class="anchor" aria-label="anchor" href="#benchmark-script-generation"></a>
</h2>
<p>Another feature of <code>r2ogs6</code> is benchmark script generation. For this, there are two functions.</p>
<ul>
<li><p><code><a href="../reference/ogs6_generate_benchmark_script.html">ogs6_generate_benchmark_script()</a></code> creates an R script from a <code>.prj</code> file</p></li>
<li><p><code><a href="../reference/ogs6_generate_benchmark_scripts.html">ogs6_generate_benchmark_scripts()</a></code> is a wrapper for the former. Instead of a single <code>.prj</code> file path, it takes a directory path as its argument.</p></li>
</ul>
<p>Let’s look at the parameters for <code><a href="../reference/ogs6_generate_benchmark_script.html">ogs6_generate_benchmark_script()</a></code> first. Say we have a project file <code>sim_file.prj</code> we want to generate a script from. Please, make sure that all the directories your are referencing exist.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The path to the project file you want to generate a script from</span></span>
<span><span class="va">prj_path</span> <span class="op">&lt;-</span> <span class="st">"your_path/sim_file.prj"</span></span>
<span></span>
<span><span class="co"># The path you want to save the simulation files to</span></span>
<span><span class="va">sim_path</span> <span class="op">&lt;-</span> <span class="st">"your_sim_directory/"</span></span>
<span></span>
<span><span class="co"># The path to your `ogs.exe` (if not already specified in `r2ogs6` options)</span></span>
<span><span class="va">ogs6_bin_path</span> <span class="op">&lt;-</span> <span class="st">"your_ogs6_bin_path/"</span></span>
<span></span>
<span><span class="co"># The path you want your benchmark script to be saved to</span></span>
<span><span class="va">script_path</span> <span class="op">&lt;-</span> <span class="st">"your_script_directory/"</span></span></code></pre></div>
<p>Now that we have defined our parameters, we can generate the benchmark script.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ogs6_generate_benchmark_script.html">ogs6_generate_benchmark_script</a></span><span class="op">(</span>prj_path <span class="op">=</span> <span class="va">prj_path</span>,</span>
<span>                               sim_path <span class="op">=</span> <span class="va">sim_path</span>,</span>
<span>                               ogs6_bin_path <span class="op">=</span> <span class="va">ogs6_bin_path</span>,</span>
<span>                               script_path <span class="op">=</span> <span class="va">script_path</span><span class="op">)</span></span></code></pre></div>
<p>On the other hand, if we want to generate R scripts from multiple (or all) benchmarks, we can use the wrapper function <code><a href="../reference/ogs6_generate_benchmark_scripts.html">ogs6_generate_benchmark_scripts()</a></code>. Its parameters are basically the same, only this time we supply it with a directory path instead of a <code>.prj</code> path to start from.</p>
<p>You can download the benchmarks (or the subfolder you need) from <a href="https://gitlab.opengeosys.org/ogs/ogs/-/tree/master/Tests/Data" class="external-link">here</a> and then set <code>path</code> to their location on your system.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The path to the directory you want to generate R scripts from</span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="st">"path/to/ogs/Tests/Data/Elliptic/"</span></span>
<span></span>
<span><span class="co"># The path you want to save the simulation files to</span></span>
<span><span class="va">sim_path</span> <span class="op">&lt;-</span> <span class="st">"your_sim_directory/"</span></span>
<span></span>
<span><span class="co"># The path you want your benchmark scripts to be saved to</span></span>
<span><span class="va">script_path</span> <span class="op">&lt;-</span> <span class="va">sim_path</span></span>
<span></span>
<span><span class="co"># Optional: Use if you want to start from a specific `.prj` file</span></span>
<span><span class="va">starting_from_prj_path</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span></span>
<span><span class="co"># Optional: Use if you want to skip specific `.prj` files</span></span>
<span><span class="va">skip_prj_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Optional: Use if you want to skip specific `.prj` files</span></span>
<span><span class="va">skip_prj_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Optional: Use if you want to restrict scripting to specific `.prj` files</span></span>
<span><span class="va">only_prj_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>And we’re set! Note that <code><a href="../reference/ogs6_generate_benchmark_scripts.html">ogs6_generate_benchmark_scripts()</a></code> will reconstruct the structure of the folder your benchmarks are stored in, e. g. if there’s a file <code>path/a/file.prj</code>, you will find the corresponding R script in <code>sim_path/a/file.R</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ogs6_generate_benchmark_scripts.html">ogs6_generate_benchmark_scripts</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">path</span>,</span>
<span>                                sim_path <span class="op">=</span> <span class="va">sim_path</span>,</span>
<span>                                script_path <span class="op">=</span> <span class="va">script_path</span>,</span>
<span>                                starting_from_prj_path <span class="op">=</span> <span class="va">starting_from_prj_path</span>,</span>
<span>                                skip_prj_paths <span class="op">=</span> <span class="va">skip_prj_paths</span>,</span>
<span>                                only_prj_files <span class="op">=</span> <span class="va">only_prj_files</span><span class="op">)</span></span></code></pre></div>
<p>With this, we can generate scripts from all benchmarks in a single call. Of course you can modify <code>path</code> to your liking if you’re only interested in generating scripts from certain subfolders.</p>
<p>Furthermore, you can restrict the script generation to benchmarks that used as test in OGS 6.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract *.prj files that are used as tests</span></span>
<span><span class="va">rel_testbm_paths</span> <span class="op">&lt;-</span> <span class="fu">get_benchmark_paths</span><span class="op">(</span><span class="st">"path/to/ogs-source-code/ProcessLib/"</span><span class="op">)</span></span>
<span><span class="va">rel_testbm_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">rel_testbm_paths</span>, <span class="va">basename</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ogs6_generate_benchmark_scripts.html">ogs6_generate_benchmark_scripts</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">path</span>,</span>
<span>                                sim_path <span class="op">=</span> <span class="va">sim_path</span>,</span>
<span>                                script_path <span class="op">=</span> <span class="va">script_path</span>,</span>
<span>                                only_prj_files <span class="op">=</span> <span class="va">rel_testbm_paths</span><span class="op">)</span></span></code></pre></div>
<p>NOTE: New benchmarks and <code>.prj</code> parameters are constantly being added to OGS6. If a benchmark contains parameters that have not been added to <code>r2ogs6</code> yet, the script generation functions will not work. If this is the case, they will be skipped and the original error message will be displayed in the console.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ruben Heinrich, Johannes Boog, Philipp Schad, Helmholtz Centre for Environmental Research - UFZ.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
